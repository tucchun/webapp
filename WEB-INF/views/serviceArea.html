<div class="wrap serviceArea">
    <div class="tb-head">社区卫生站管理&gt;&gt;服务分区</div>
    <div class="tb-wrap">
        <div class="opt">
            <button class="btn btn-main" type="button" data-toggle="modal" data-target="#modal_serviceArea">新建服务分区
            </button>
        </div>
        <table cellspacing="0" class="table table-striped table-hover table-bordered">
            <thead>
            <tr>
                <th>序号</th>
                <th>服务区</th>
                <th>户数</th>
                <th>操作</th>
            </tr>
            </thead>
            <tbody>
            <tr>
                <td>1</td>
                <td>西山社区卫生站服务1区</td>
                <td>200</td>
                <td class="optCol"><a href="#">编辑</a><a href="#">删除</a></td>
            </tr>
            <tr>
                <td>1</td>
                <td>西山社区卫生站服务1区</td>
                <td>200</td>
                <td class="optCol"><a href="#">编辑</a><a href="#">删除</a></td>
            </tr>
            <tr>
                <td>1</td>
                <td>西山社区卫生站服务1区</td>
                <td>200</td>
                <td class="optCol"><a href="#">编辑</a><a href="#">删除</a></td>
            </tr>
            <tr>
                <td>1</td>
                <td>西山社区卫生站服务1区</td>
                <td>200</td>
                <td class="optCol"><a href="#">编辑</a><a href="#">删除</a></td>
            </tr>
            <tr>
                <td>1</td>
                <td>西山社区卫生站服务1区</td>
                <td>200</td>
                <td class="optCol"><a href="#">编辑</a><a href="#">删除</a></td>
            </tr>
            </tbody>
        </table>
    </div>
    <div id="modal_serviceArea" class="modal fade">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                    <h4 class="modal-title" id="modal_roleLabel">设置服务分区</h4>
                </div>
                <div class="modal-body">
                    <div class="clearfix" id="select-community">
                        <div class="clearfix">
                            <div class="filter pull-left">
                                <select name="" id="js-buildingSelects" class="form-control" data-level="1">
                                    <option value="1">小区</option>
                                </select>
                                <select name="" id="js-headerSelects" class="form-control" data-level="2">
                                    <option value="1">楼栋</option>
                                </select>
                                <!--<select name="" class="form-control" data-level="3">-->
                                <!--<option value="1">单元</option>-->
                                <!--</select>-->
                            </div>
                            <div class="filter pull-right" id="select-remain">还剩余199户</div>
                        </div>
                        <div class="pull-left">

                            <select multiple id="js-detailSelects" name="" class="form-control multiple select-left">
                                <option value="1">付宇轩1栋1单元102</option>
                                <option value="1">付宇轩1栋1单元102</option>
                                <option value="1">付宇轩1栋1单元102</option>
                                <option value="1">付宇轩1栋1单元102</option>
                                <option value="1">付宇轩1栋1单元102</option>
                                <option value="1">付宇轩1栋1单元102</option>
                                <option value="1">付宇轩1栋1单元102</option>
                                <option value="1">付宇轩1栋1单元102</option>
                                <option value="1">付宇轩1栋1单元102</option>
                                <option value="1">付宇轩1栋1单元102</option>
                                <option value="1">付宇轩1栋1单元102</option>
                            </select>
                        </div>
                        <div class="pull-left move-icon select-opt">
                            <button type="button" class="btn btn-default add">&gt;&gt;</button>
                            <button type="button" class="btn btn-default del">&lt;&lt;</button>
                        </div>
                        <div class="pull-left">

                            <select multiple name="" class="form-control multiple select-right">
                                <option value="1">付宇轩1栋1单元102</option>
                                <option value="1">付宇轩1栋1单元102</option>
                                <option value="1">付宇轩1栋1单元102</option>
                                <option value="1">付宇轩1栋1单元102</option>
                                <option value="1">付宇轩1栋1单元102</option>
                                <option value="1">付宇轩1栋1单元102</option>
                                <option value="1">付宇轩1栋1单元102</option>
                                <option value="1">付宇轩1栋1单元102</option>
                                <option value="1">付宇轩1栋1单元102</option>
                                <option value="1">付宇轩1栋1单元102</option>
                                <option value="1">付宇轩1栋1单元102</option>
                            </select>
                        </div>
                    </div>
                    <div class="opt">
                        <button class="btn btn-main">设置为西山社区卫生站服务1区</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script type="text/javascript">
        var data = {
            "buildingSelects": [
                {
                    "code": "120",
                    "name": "专干第21小区"
                },
                {
                    "code": "151",
                    "name": "保利叶语"
                }
            ],
            "headerSelects": [
                {
                    "code": "120",
                    "name": "专干第21小区A栋A单元",
                    "parent": "null"
                },
                {
                    "code": "153",
                    "name": "保利叶语2栋B单元",
                    "parent": "151"
                },
                {
                    "code": "154",
                    "name": "保利叶语3栋C单元",
                    "parent": "151"
                },
                {
                    "code": "155",
                    "name": "保利叶语4栋D单元",
                    "parent": "151"
                }
            ],
            "detailSelects": [
                {
                    "code": "6643",
                    "name": "A101",
                    "parent": "120"
                },
                {
                    "code": "6644",
                    "name": "A102",
                    "parent": "120"
                },
                {
                    "code": "6645",
                    "name": "A103",
                    "parent": "120"
                },
                {
                    "code": "6646",
                    "name": "A201",
                    "parent": "120"
                },
                {
                    "code": "6647",
                    "name": "A202",
                    "parent": "120"
                },
                {
                    "code": "6648",
                    "name": "A203",
                    "parent": "120"
                },
                {
                    "code": "6649",
                    "name": "A301",
                    "parent": "120"
                },
                {
                    "code": "6650",
                    "name": "A302",
                    "parent": "120"
                },
                {
                    "code": "6651",
                    "name": "A303",
                    "parent": "120"
                },
                {
                    "code": "6718",
                    "name": "201",
                    "parent": "153"
                },
                {
                    "code": "6719",
                    "name": "202",
                    "parent": "153"
                },
                {
                    "code": "6720",
                    "name": "301",
                    "parent": "154"
                },
                {
                    "code": "6721",
                    "name": "302",
                    "parent": "154"
                },
                {
                    "code": "6722",
                    "name": "401",
                    "parent": "155"
                },
                {
                    "code": "6723",
                    "name": "402",
                    "parent": "155"
                },
                {
                    "code": "6724",
                    "name": "403",
                    "parent": "155"
                },
                {
                    "code": "6725",
                    "name": "404",
                    "parent": "155"
                },
                {
                    "code": "6726",
                    "name": "405",
                    "parent": "155"
                }
            ]
        };
        require(['jquery', 'js/components-select', 'js/cascade'], function ($, select, cascade) {

            var $buildingSelects = $("#js-buildingSelects");
            var $headerSelects = $("#js-headerSelects");
            var $detailSelects = $("#js-detailSelects");
            new select('#select-community', true);

            new cascade({
                $primary: $buildingSelects,
                $secondary: $headerSelects,
                primaryData: data.buildingSelects,
                secondaryData: data.headerSelects,
                parentId: "parent",
                defaultPrimary: "",
                defaultSecondary: ""
            });

            $buildingSelects.on("change", function(){
                renderDetailSelects();
            });
            $headerSelects.on("change", function(){
                renderDetailSelects();
            });





            function renderDetailSelects(){
                var html = [];
                var detailSelectsData = [];

                var buildingSelectsValue = $buildingSelects.val();
                var headerSelectsValue = $headerSelects.val();
                if(headerSelectsValue){
                    detailSelectsData = _.filter(data.detailSelects, function(item){
                        return item.parent === headerSelectsValue;
                    });
                }else{
                    if(buildingSelectsValue){
                        var headerSelectsData = _.filter(data.headerSelects, function(item){
                            return item.parent === buildingSelectsValue;
                        });
                        _.each(headerSelectsData, function(item){
                            var tempArr = _.filter(data.detailSelects, function(detailSelectsItem){
                                return detailSelectsItem.parent === item.code;
                            });
                            _.concat(detailSelectsData, tempArr);
                        });

                    }else{
                        detailSelectsData =  data.detailSelects;
                    }
                }

                _.each(detailSelectsData, function(item){
                    html.push("<option value='"+ item.code +"'>"+ item.name +"</option>");
                });
                $detailSelects.html(html.join(""));
            }

            renderDetailSelects();
        });
    </script>
</div>
